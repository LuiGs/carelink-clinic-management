// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Roles de usuario del sistema
enum Role {
  PROFESIONAL
  MESA_ENTRADA
  GERENTE
}

// Modelo de usuario con autenticación básica y rol
model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String?
  passwordHash  String
  role          Role?     // Optional, assigned after creation
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  sessions      Session[]

  // Relaciones con pacientes y turnos
  createdPatients     Patient[]      @relation("PatientCreator")
  professionalAppointments Appointment[] @relation("ProfesionalAppointments")
  createdAppointments      Appointment[] @relation("CreatorAppointments")


  @@map("users")
}

// Sesiones simples basadas en token para manejo de login
model Session {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  token     String   @unique
  createdAt DateTime @default(now())
  expiresAt DateTime

  @@map("sessions")
}

// Obras sociales disponibles en Argentina
model ObraSocial {
  id          String    @id @default(cuid())
  nombre      String    @unique
  codigo      String?   @unique
  activa      Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relación con turnos
  appointments Appointment[]

  @@map("obras_sociales")
}

// Modelo de paciente con campos específicos para Argentina
model Patient {
  id              String      @id @default(cuid())
  // Datos personales
  nombre          String
  apellido        String
  dni             String      @unique
  fechaNacimiento DateTime
  genero          String      // M, F, Otro
  telefono        String?
  celular         String?
  email           String?
  
  // Dirección
  direccion       String?
  ciudad          String?
  provincia       String?
  codigoPostal    String?
  
  // Contacto de emergencia
  contactoEmergenciaNombre    String?
  contactoEmergenciaTelefono  String?
  contactoEmergenciaRelacion  String?
  
  // Sistema
  activo          Boolean     @default(true) // Estado del paciente (Activo/Inactivo)
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  createdBy       String      // ID del usuario que creó el paciente
  creator         User        @relation("PatientCreator", fields: [createdBy], references: [id])
  
  // Turnos
  appointments    Appointment[]

  @@map("patients")
}

// Estados posibles de un turno
enum AppointmentStatus {
  PROGRAMADO
  CONFIRMADO
  EN_SALA_DE_ESPERA
  COMPLETADO
  CANCELADO
  NO_ASISTIO
}

// Tipos de consulta
enum TipoConsulta {
  OBRA_SOCIAL
  PARTICULAR
}

// Modelo de turnos/citas
model Appointment {
  id            String            @id @default(cuid())
  fecha         DateTime
  duracion      Int               @default(30) // minutos
  motivo        String?
  observaciones String?
  estado        AppointmentStatus @default(PROGRAMADO)
  
  // Campos para obra social específicos del turno
  obraSocialId         String?          // Obra social al momento del turno
  numeroAfiliado       String?          // Número de afiliado al momento del turno  
  tipoConsulta         TipoConsulta     @default(OBRA_SOCIAL) // Particular, Obra Social
  copago              Decimal?         // Monto de copago o precio particular
  autorizacion        String?          // Número de autorización de obra social
  
  // Relaciones
  pacienteId    String
  paciente      Patient          @relation(fields: [pacienteId], references: [id], onDelete: Cascade)
  profesionalId String
  profesional   User             @relation("ProfesionalAppointments", fields: [profesionalId], references: [id])
  createdBy     String           // Usuario que creó el turno (mesa de entrada)
  creator       User             @relation("CreatorAppointments", fields: [createdBy], references: [id])
  
  // Relación con obra social
  obraSocial           ObraSocial?      @relation(fields: [obraSocialId], references: [id])
  
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt

  @@map("appointments")
}